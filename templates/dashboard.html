{% extends 'base.html' %}

{% block content %}
<div class="mb-8">
    <h2 class="text-3xl font-bold text-gray-800">Admin Dashboard</h2>
    <p class="text-gray-500 mt-1">Overview of today's HR metrics.</p>
</div>

<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 flex items-center">
        <div class="w-12 h-12 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xl mr-4">
            <i class="fa-solid fa-users"></i>
        </div>
        <div>
            <p class="text-sm text-gray-500 font-medium">Total Employees</p>
            <h3 class="text-2xl font-bold text-gray-800" id="statTotal">-</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 flex items-center">
        <div class="w-12 h-12 rounded-full bg-green-100 text-green-600 flex items-center justify-center text-xl mr-4">
            <i class="fa-solid fa-user-check"></i>
        </div>
        <div>
            <p class="text-sm text-gray-500 font-medium">Present Today</p>
            <h3 class="text-2xl font-bold text-gray-800" id="statPresent">-</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 flex items-center">
        <div class="w-12 h-12 rounded-full bg-red-100 text-red-600 flex items-center justify-center text-xl mr-4">
            <i class="fa-solid fa-user-xmark"></i>
        </div>
        <div>
            <p class="text-sm text-gray-500 font-medium">Absent Today</p>
            <h3 class="text-2xl font-bold text-gray-800" id="statAbsent">-</h3>
        </div>
    </div>

    <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100 flex items-center">
        <div class="w-12 h-12 rounded-full bg-yellow-100 text-yellow-600 flex items-center justify-center text-xl mr-4">
            <i class="fa-solid fa-clock"></i>
        </div>
        <div>
            <p class="text-sm text-gray-500 font-medium">Pending Action</p>
            <h3 class="text-2xl font-bold text-gray-800" id="statUnmarked">-</h3>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
        <h4 class="font-bold text-gray-800 mb-4">Attendance Overview (Today)</h4>
        <div class="relative h-64">
            <canvas id="attendanceChart"></canvas>
        </div>
    </div>

    <div class="bg-gradient-to-br from-slate-800 to-slate-900 p-6 rounded-xl shadow-lg text-white flex flex-col justify-between">
        <div>
            <h4 class="font-bold text-xl mb-2">Quick Actions</h4>
            <p class="text-gray-400 text-sm mb-6">Manage your daily HR tasks efficiently.</p>
        </div>
        
        <div class="space-y-3">
            <a href="/employees/" class="block w-full bg-white/10 hover:bg-white/20 transition p-3 rounded-lg flex items-center">
                <i class="fa-solid fa-plus-circle w-8"></i> Add New Employee
            </a>
            <a href="/attendance-ui/" class="block w-full bg-white/10 hover:bg-white/20 transition p-3 rounded-lg flex items-center">
                <i class="fa-solid fa-clipboard-check w-8"></i> Mark Attendance
            </a>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    async function loadStats() {
        try {
            const res = await fetch('/api/stats/');
            const data = await res.json();

            // Update Numbers
            document.getElementById('statTotal').innerText = data.total_employees;
            document.getElementById('statPresent').innerText = data.present_today;
            document.getElementById('statAbsent').innerText = data.absent_today;
            document.getElementById('statUnmarked').innerText = data.unmarked;

            // Render Chart
            const ctx = document.getElementById('attendanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Present', 'Absent', 'Pending'],
                    datasets: [{
                        data: [data.present_today, data.absent_today, data.unmarked],
                        backgroundColor: ['#22c55e', '#ef4444', '#eab308'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });

        } catch (error) {
            console.error("Error loading stats:", error);
        }
    }

    loadStats();
</script>
{% endblock %}